<div class="col-md-12 col-xs-12">
  <div class="panel panel-primary">
      <div class="panel-heading">
        <div class="row">
          <h3 style="margin-left:15px"><%= t('today_games') %></h3>
        </div>
      </div>
      <div class="panel-body" id="append-games">
              <div class="row">
            <h3 style="text-align:center"> <%= t('games_today') %> </h3>
          </div>
      <!-- end panel-body -->
    </div>
</div>

<script>


          $.ajax({
                      method: "GET",
                      url: "/games/today_games.json",
                      dataType: "json"
                    }).done(function( data) {
                        for(var i in data.games){


                        if(data.games[i].lotteries[0].winner_number == null){
                          if(data.games[i].lotteries[0].game2_id != null && data.games[i].lotteries[0].game2_id != ""){
                            if(data.games[i].lotteries[0].final_number == 999){
                              $('#append-games').append('<div class="row"> <div class="col-md-2"> <br> <h4 style="text-align:center"> <%= t("instruction_close_games") %> </h4> <br> <h4 style="text-align:center"> <button class="button btn   btn-default update_score" data-id="'+data.games[i].id+'" data-secondid="'+data.games[i].lotteries[0].game2.id+'" > <%= t("update_score") %> </button> </h4> <br> <h4 style="text-align:center"> Número Ganador </h4> <input style="text-align:center" class="form-control" id="winner_number_input'+data.games[i].id+'" > <br> <h4 style="text-align:center"><button class="button btn btn-danger close_lottery" data-id="'+data.games[i].id+'" data-idlottery="'+data.games[i].lotteries[0].id+'"  > <%= t("close_lottery") %> </button> </h4> </div><div class="col-md-3"> <h4 style="text-align:center"><img style="max-height:250px; width="60%" src="'+ data.games[i].team.logo_url +'"> </h4> <h4 style="text-align:center"> <input type="number" style="width: 30%; margin-left:35%; text-align:center; font-size:30px; height:60px;" id="team_local_score'+data.games[i].id+'" value="' + data.games[i].local_score + '" class="form-control"> </h4> </div>  <div class="col-md-3"> <h4 style="text-align:center"> <img style="max-height:250px; width="60%" src="'+ data.games[i].team2.logo_url +'">  </h4> <h4 style="text-align:center"> <input type="number" style="width: 30%; margin-left:35%;  text-align:center; font-size:30px; height:60px;" id="team_visit_score'+data.games[i].id+'" value="' + data.games[i].visit_score + '" class="form-control"> </h4> </div> <div class="col-md-3"> <h4 style="text-align:center"> <img style="max-height:250px; width="60%" src="'+ data.games[i].lotteries[0].team.logo_url +'">  </h4> <h4 style="text-align:center"> <input type="number" style="width: 30%; margin-left:35%;  text-align:center; font-size:30px; height:60px;" id="team3_score'+data.games[i].id+'" value="' + data.games[i].lotteries[0].game2.local_score + '" class="form-control"> </h4> </div> </div> <hr>');
                          }else{}

                            if(data.games[i].lotteries[0].final_number == 9999){
                              $('#append-games').append('<div class="row"> <div class="col-md-2"> <br> <h4 style="text-align:center"> <%= t("instruction_close_games") %> </h4> <br> <h4 style="text-align:center"> <button class="button btn   btn-default update_score" data-id="'+data.games[i].id+'"  data-secondid="'+data.games[i].lotteries[0].game2.id+'" > <%= t("update_score") %> </button> </h4> <br> <h4 style="text-align:center"> Número Ganador </h4> <input style="text-align:center" class="form-control" id="winner_number_input'+data.games[i].id+'" > <br> <h4 style="text-align:center"><button class="button btn btn-danger close_lottery" data-id="'+data.games[i].id+'" data-idlottery="'+data.games[i].lotteries[0].id+'"  > <%= t("close_lottery") %> </button> </h4> </div> <div class="col-md-1"></div> <div class="col-md-2"> <h4 style="text-align:center"><img style="max-height:250px; width:100%" src="'+ data.games[i].team.logo_url +'"> </h4> <h4 style="text-align:center"> <input type="number" style="width: 50%; margin-left:35%; text-align:center; font-size:30px; height:60px;" id="team_local_score'+data.games[i].id+'" value="' + data.games[i].local_score + '" class="form-control"> </h4> </div>  <div class="col-md-2"> <h4 style="text-align:center"> <img style="max-height:250px; width:100%" src="'+ data.games[i].team2.logo_url +'">  </h4> <h4 style="text-align:center"> <input type="number" style="width: 50%; margin-left:35%;  text-align:center; font-size:30px; height:60px;" id="team_visit_score'+data.games[i].id+'" value="' + data.games[i].visit_score + '" class="form-control"> </h4> </div> <div class="col-md-2"> <h4 style="text-align:center"> <img style="max-height:250px; width:100%" src="'+ data.games[i].lotteries[0].team.logo_url +'">  </h4> <h4 style="text-align:center"> <input type="number" style="width: 50%; margin-left:35%;  text-align:center; font-size:30px; height:60px;" id="team3_score'+data.games[i].id+'" value="' + data.games[i].lotteries[0].game2.local_score + '" class="form-control"> </h4> </div> <div class="col-md-2"> <h4 style="text-align:center"> <img style="max-height:250px; width:100%" src="'+ data.games[i].lotteries[0].team2.logo_url +'">  </h4> <h4 style="text-align:center"> <input type="number" style="width: 50%; margin-left:35%;  text-align:center; font-size:30px; height:60px;" id="team4_score'+data.games[i].id+'" value="' + data.games[i].lotteries[0].game2.visit_score + '" class="form-control"> </h4> </div> </div> <hr>');

                            }else{}

                          }else{
                              $('#append-games').append('<div class="row"> <div class="col-md-2"> <br> <h4 style="text-align:center"> <%= t("instruction_close_games") %> </h4> <br> <h4 style="text-align:center"> <button class="button btn   btn-default update_score" data-id="'+data.games[i].id+'"  data-secondid="null" > <%= t("update_score") %> </button> </h4> <br> <h4 style="text-align:center"> Número Ganador </h4> <input style="text-align:center" class="form-control" id="winner_number_input'+data.games[i].id+'" > <br> <h4 style="text-align:center"><button class="button btn btn-danger close_lottery" data-id="'+data.games[i].id+'" data-idlottery="'+data.games[i].lotteries[0].id+'"  > <%= t("close_lottery") %> </button> </h4> </div><div class="col-md-4"> <h4 style="text-align:center"><img style="max-height:250px; width="60%" src="'+ data.games[i].team.logo_url +'"> </h4> <h4 style="text-align:center"> <input type="number" style="width: 30%; margin-left:35%; text-align:center; font-size:30px; height:60px;" id="team_local_score'+data.games[i].id+'" value="' + data.games[i].local_score + '" class="form-control"> </h4> </div> <div class="col-md-2"> <br> <br> <br> <br> <br> <h1 style="text-align:center; font-size:50px; font-weight:900;"> VS </h1> </div> <div class="col-md-4"> <h4 style="text-align:center"> <img style="max-height:250px; width="60%" src="'+ data.games[i].team2.logo_url +'">  </h4> <h4 style="text-align:center"> <input type="number" style="width: 30%; margin-left:35%;  text-align:center; font-size:30px; height:60px;" id="team_visit_score'+data.games[i].id+'" value="' + data.games[i].visit_score + '" class="form-control"> </h4> </div> </div> <hr>');
                          }

                                 var winner = String(data.games[i].local_score % 10) + String(data.games[i].visit_score % 10);
                                 $("#winner_number_input"+data.games[i].id).val(winner);

                                  $(".update_score").click(function(){
                                       var game_id = $(this).data("id");
                                       var secondgame_id = $(this).data("secondid");
                                       var loca_score = $("#team_local_score"+game_id+"").val();
                                       var visit_score = $("#team_visit_score"+game_id+"").val();
                                       var team3 = $("#team3_score"+game_id+"").val();
                                       var team4 = $("#team4_score"+game_id+"").val();
                                           $.ajax({
                                                  method: "PUT",
                                                 url: "/games/"+game_id,
                                                data: { game: {local_score: loca_score, visit_score: visit_score} },
                                               dataType: "json"
                                                  }).done(function(data){
                                                 location.reload();
                                                 })

                                                 if(secondgame_id != null && secondgame_id != "null"){
                                                   $.ajax({
                                                          method: "PUT",
                                                         url: "/games/"+secondgame_id,
                                                        data: { game: {local_score: team3, visit_score: team4} },
                                                       dataType: "json"
                                                          }).done(function(data){
                                                         location.reload();
                                                         })
                                                 }

                                              });




                                  $(".close_lottery").click(function(){
                                       var game_id = $(this).data("id");
                                      var lottery_id = $(this).data('idlottery');
                                       var winner_number = $("#winner_number_input"+game_id+"").val();

                                           $.ajax({
                                                  method: "PUT",
                                                 url: "/lotteries/"+lottery_id,
                                                data: { lottery: {winner_number: winner_number} },
                                               dataType: "json"
                                                  }).done(function(data){
                                               alert("Se cerro la loteria");
                                                 location.reload();
                                                 })
                                              });

                        }else{
                          if(data.games[i].lotteries[0].game2_id != null && data.games[i].lotteries[0].game2_id != ""){
                            if(data.games[i].lotteries[0].final_number == 999){
                              $('#append-games').append('<div class="row"> <div class="col-md-2"> <br> <h4 style="text-align:center"> <%= t("instruction_close_games") %> </h4> <br> <h4 style="text-align:center"> <button class="button btn   btn-default update_score" data-id="'+data.games[i].id+'" data-secondid="'+data.games[i].lotteries[0].game2.id+'" > <%= t("update_score") %> </button> </h4> <br> <h4 style="text-align:center"> Número Ganador </h4> <input disabled style="text-align:center" class="form-control" id="winner_number_input'+data.games[i].id+'" > <br> <h4 style="text-align:center"><button class="button btn btn-danger close_lottery" data-id="'+data.games[i].id+'" data-idlottery="'+data.games[i].lotteries[0].id+'"  > <%= t("close_lottery") %> </button> </h4> </div><div class="col-md-3"> <h4 style="text-align:center"><img style="max-height:250px; width="60%" src="'+ data.games[i].team.logo_url +'"> </h4> <h4 style="text-align:center"> <input type="number" style="width: 30%; margin-left:35%; text-align:center; font-size:30px; height:60px;" id="team_local_score'+data.games[i].id+'" disabled value="' + data.games[i].local_score + '" class="form-control"> </h4> </div>  <div class="col-md-3"> <h4 style="text-align:center"> <img style="max-height:250px; width="60%" src="'+ data.games[i].team2.logo_url +'">  </h4> <h4 style="text-align:center"> <input disabled type="number" style="width: 30%; margin-left:35%;  text-align:center; font-size:30px; height:60px;" id="team_visit_score'+data.games[i].id+'" value="' + data.games[i].visit_score + '" class="form-control"> </h4> </div> <div class="col-md-3"> <h4 style="text-align:center"> <img style="max-height:250px; width="60%" src="'+ data.games[i].lotteries[0].team.logo_url +'">  </h4> <h4 style="text-align:center"> <input disabled type="number" style="width: 30%; margin-left:35%;  text-align:center; font-size:30px; height:60px;" id="team3_score'+data.games[i].id+'" value="' + data.games[i].lotteries[0].game2.local_score + '" class="form-control"> </h4> </div> </div> <hr>');
                          }else{}

                            if(data.games[i].lotteries[0].final_number == 9999){
                              $('#append-games').append('<div class="row"> <div class="col-md-2"> <br> <h4 style="text-align:center"> <%= t("instruction_close_games") %> </h4> <br> <h4 style="text-align:center"> <button class="button btn   btn-default update_score" data-id="'+data.games[i].id+'"  data-secondid="'+data.games[i].lotteries[0].game2.id+'" > <%= t("update_score") %> </button> </h4> <br> <h4 style="text-align:center"> Número Ganador </h4> <input disabled style="text-align:center" class="form-control" id="winner_number_input'+data.games[i].id+'" > <br> <h4 style="text-align:center"><button class="button btn btn-danger close_lottery" data-id="'+data.games[i].id+'" data-idlottery="'+data.games[i].lotteries[0].id+'"  > <%= t("close_lottery") %> </button> </h4> </div> <div class="col-md-1"></div> <div class="col-md-2"> <h4 style="text-align:center"><img style="max-height:250px; width:100%" src="'+ data.games[i].team.logo_url +'"> </h4> <h4 style="text-align:center"> <input disabled type="number" style="width: 30%; margin-left:35%; text-align:center; font-size:30px; height:60px;" id="team_local_score'+data.games[i].id+'" value="' + data.games[i].local_score + '" class="form-control"> </h4> </div>  <div class="col-md-2"> <h4 style="text-align:center"> <img style="max-height:250px; width:100%" src="'+ data.games[i].team2.logo_url +'">  </h4> <h4 style="text-align:center"> <input disabled type="number" style="width: 30%; margin-left:35%;  text-align:center; font-size:30px; height:60px;" id="team_visit_score'+data.games[i].id+'" value="' + data.games[i].visit_score + '" class="form-control"> </h4> </div> <div class="col-md-2"> <h4 style="text-align:center"> <img style="max-height:250px; width:100%" src="'+ data.games[i].lotteries[0].team.logo_url +'">  </h4> <h4 style="text-align:center"> <input disabled type="number" style="width: 30%; margin-left:35%;  text-align:center; font-size:30px; height:60px;" id="team3_score'+data.games[i].id+'" value="' + data.games[i].lotteries[0].game2.local_score + '" class="form-control"> </h4> </div> <div class="col-md-2"> <h4 style="text-align:center"> <img style="max-height:250px; width:100%" src="'+ data.games[i].lotteries[0].team2.logo_url +'">  </h4> <h4 style="text-align:center"> <input disabled type="number" style="width: 30%; margin-left:35%;  text-align:center; font-size:30px; height:60px;" id="team4_score'+data.games[i].id+'" value="' + data.games[i].lotteries[0].game2.visit_score + '" class="form-control"> </h4> </div> </div> <hr>');

                            }else{}

                          }else{
                            $('#append-games').append('<div class="row" style="background-color: #F3A5A5;"> <div class="col-md-2"> <br> <h4 style="text-align:center"> <%= t("close_lottery_message") %> </h4> <h4 style="text-align:center"> Número Ganador </h4> <input disabled style="text-align:center" class="form-control" id="winner_number_input'+data.games[i].id+'" ></div><div class="col-md-4"> <h4 style="text-align:center"><img width="60%" style="max-height:250px;" src="'+ data.games[i].team.logo_url +'"> </h4> <h4 style="text-align:center"> <input type="number" disabled style="width: 30%; margin-left:35%; text-align:center; font-size:30px; height:60px;" id="team_local_score'+data.games[i].id+'" value="' + data.games[i].local_score + '" class="form-control"> </h4> </div> <div class="col-md-2"> <br> <br> <br> <br> <br> <h1 style="text-align:center; font-size:50px; font-weight:900;"> VS </h1> </div> <div class="col-md-4"> <h4 style="text-align:center"> <img width="60%" style="max-height:250px;" src="'+ data.games[i].team2.logo_url +'">  </h4> <h4 style="text-align:center"> <input type="number" disabled style="width: 30%; margin-left:35%;  text-align:center; font-size:30px; height:60px;" id="team_visit_score'+data.games[i].id+'" value="' + data.games[i].visit_score + '" class="form-control"> </h4> </div> </div> <hr>');

                          }
                          }

                          if(data.games[i].lotteries[0].game2_id != null && data.games[i].lotteries[0].game2_id != ""){
                          if(data.games[i].lotteries[0].final_number == 999){
                              var winner = String(data.games[i].local_score % 10) + String(data.games[i].visit_score % 10) + String(data.games[i].lotteries[0].game2.local_score % 10);
                          }else{}
                          if(data.games[i].lotteries[0].final_number == 9999){
                              var winner = String(data.games[i].local_score % 10) + String(data.games[i].visit_score % 10) + String(data.games[i].lotteries[0].game2.local_score % 10) + String(data.games[i].lotteries[0].game2.visit_score % 10) ;
                          }else{}
                        }else{
                            var winner = String(data.games[i].local_score % 10) + String(data.games[i].visit_score % 10);
                        }


                         alert(winner);
                         $("#winner_number_input"+data.games[i].id).val(winner);

                        }

                     });

 </script>
