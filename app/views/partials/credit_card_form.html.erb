<% if current_user.address_1 == nil || current_user.address_2 == nil || current_user.ext_number == nil || current_user.int_number ==nil || current_user.state == nil || current_user.city == nil || current_user.zip_code == nil %>
<script>
    alert('Para poder realizar la compra debes de completar todos tus datos del registro.');
    location.replace("/users/"+ <%= current_user.id %> +"/edit");
</script>
    
<% end %>

       

<script type="text/javascript" 
        src="https://openpay.s3.amazonaws.com/openpay.v1.min.js"></script>
<script type='text/javascript' 
  src="https://openpay.s3.amazonaws.com/openpay-data.v1.min.js"></script>

<script type="text/javascript">
 $(document).ready(function() {
     var flag_card = false;
     $("input[name='optradio']").change(function(){
         flag_card = true;
     })
     
     $("input[name='amountradio']").change(function(){
         var amount_select = $("input[name='amountradio']:checked").val();
         $('#amount').val(amount_select);
     })
 
     
  
     
  var deviceSessionId = OpenPay.deviceData.setup("payment-form", "deviceIdHiddenFieldName");
       OpenPay.setId('ml8ii2xvkgmpoxjl0aib');
       OpenPay.setApiKey('pk_8e59eadca8fe4fc9804c6e4492c376f0');
       OpenPay.setSandboxMode(false);
     
     $('#pay-button').on('click', function(event) {
       event.preventDefault();
       $("#pay-button").prop( "disabled", true);
       OpenPay.token.extractFormAndCreate('payment-form', success_callbak, error_callbak);                
});
     
      $('#register-button').on('click', function(event) {
       event.preventDefault();
       $("#register-button").prop( "disabled", true);
         $('#payment-form').append('<input type="disabled" name="only_register" id="only_register" value="true" >');         
       OpenPay.token.extractFormAndCreate('payment-form', success_callbak, error_callbak);                
});
     
     $('#pay-button-used').on('click',function(event){
         event.preventDefault();
         $('#pay-button-used').prop('disabled', true);
         var current_id = $("input[name='optradio']:checked").val();
         $('#token_id').val(current_id);
          $('#payment-form').submit();
     })
     
     var success_callbak = function(response) {
              var token_id = response.data.id;
              $('#token_id').val(token_id);
              $('#payment-form').submit();
};
     
     var error_callbak = function(response) {
     var desc = response.data.description != undefined ? 
        response.data.description : response.message;
     alert("ERROR [" + response.status + "] " + desc);
     $("#pay-button").prop("disabled", false);
};
  });

</script>


<div class="row">

<div class="col-md-2 col-xs-12">
     <h2 style="background-color:#E4007D;  color:white; font-size: 24px; line-height: 24px; margin: 0; padding: 28px 0 28px 20px; width: 100%;"><%= t('amount') %> <br> <span style=" font-size:14px; font-weight:900;">* 1 DB = $1.00 MXN </span> </h2>
	
    <div class="row" style="background-color:white;">
         <div class="radio">
            <label style="margin-left:30px; margin-top:30px; font-weight:900; font-size:18px" ><input checked style="" type="radio" value="20" name="amountradio"><span style="color:#E4007D; padding-left:10px;"><i class="fa fa-ticket fa-2x"></i> 20 DB </span> </label>
              <label style="margin-left:30px; margin-top:30px; font-weight:900; font-size:18px" ><input style="" type="radio" value="40" name="amountradio"><span style="color:#E4007D; padding-left:10px;"><i class="fa fa-ticket fa-2x"></i> 40 DB </span> </label>
              <label style="margin-left:30px; margin-top:30px; font-weight:900; font-size:18px" ><input style="" type="radio" value="100" name="amountradio"><span style="color:#E4007D; padding-left:10px;"><i class="fa fa-ticket fa-2x"></i> 100 DB </span> </label>
               <label style="margin-left:30px; margin-top:30px; font-weight:900; font-size:18px" ><input style="" type="radio" value="200" name="amountradio"><span style="color:#E4007D; padding-left:10px;"><i class="fa fa-ticket fa-2x"></i> 200 DB </span> </label>
               <label style="margin-left:30px; margin-top:30px; font-weight:900; font-size:18px" ><input style="" type="radio" value="500" name="amountradio"><span style="color:#E4007D; padding-left:10px;"><i class="fa fa-ticket fa-2x"></i> 500 DB </span> </label>
               <label style="margin-left:30px; margin-top:30px; font-weight:900; font-size:18px" ><input style="" type="radio" value="1000" name="amountradio"><span style="color:#E4007D; padding-left:10px;"><i class="fa fa-ticket fa-2x"></i> 1000 DB </span> </label>
        </div>
    </div>
    </div>
<div class="col-md-3 col-xs-12">
    <h2 style="background-color:#E4007D; color:white; font-size: 24px; line-height: 24px; margin: 0; padding: 28px 0 28px 20px; width: 100%;"><%= t('register_cards') %></h2>
            <div class="row" style="background-color:white;">
            <% if @get_cards != [] && @get_cards != nil  %>
             <% @get_cards.each do |card| %>
                <div class="radio">
                    <label style="margin-left:30px; font-weight:900;" ><img width="50px"src="/assets/<%= card['brand'] %>.ico"><input style="margin-top:18px; margin-left:-70px;" type="radio" value="<%= card['id'] %>" name="optradio"><span style="color:#E4007D; padding-left:10px;"><%= t('card') %>: </span> <%= card['card_number'] %><i data-card="<%= card['id'] %>" style="color:red; margin-left: 10px; font-size: 22px;" class="fa fa-times-circle delete_card"></i></label>
                </div>
              <% end %>
    <a style="color:white;" class="button rght" id="pay-button-used"><%= t('buy') %></a>
        <% else %>
            <br>
    <h3 style="text-align:center"><%= t('noregistercards') %></h3>
        <% end %>
    </div>
       
     
    </div>
	
	<div class="col-md-7 col-xs-12">
		<form style="width:100%" action="#" method="POST" id="payment-form">
			<h2 style="background-color:#E4007D; color:white; padding:28px 0 28px 20px; margin:0px;"><%= t('registeredmon') %></h2>
			<div class="row" style="background-color:white;">
				<div class="row">
			<div class="col-md-4" >
				<h4><%= t('creditcard') %></h4>
				<img src="/assets/cards1.png">
				</div>
			<div class="col-md-8" style="border-left:1px solid gray;">
				<h4><%= t('debitcard') %></h4>
				<img width="100%" src="/assets/cards2.png">
				</div>
					</div>
				<br><hr>
					<div class="row">
				<div class="col-md-6 col-xs-12">
				  <label><%= t('owner_name') %></label><input type="text" class="form-control" placeholder="Como aparece en la tarjeta" autocomplete="off" data-openpay-card="holder_name">
				</div>
				<div class="col-md-6 col-xs-12 margin-cellphone">
				 <label><%= t('card_number') %></label><input class="form-control" type="text" autocomplete="off" data-openpay-card="card_number"></div>
						</div>
				<br>
				<div class="row">
					<div class="col-md-6 col-xs-12 ">
						<h4><label><%= t('expiration_date') %></label></h4>
					<div class="col-md-6 col-xs-6" style="padding:0px;">
						  
                                  <input class="form-control" type="text" placeholder="Mes" data-openpay-card="expiration_month">
                                    
						</div>
						<div class="col-md-6 col-xs-6">
						<input  class="form-control" type="text" placeholder="Año" data-openpay-card="expiration_year">
						</div>
					</div> 
					<div class="col-md-6 col-xs-12 margin-cellphone">
						 <h4><label><%= t('security_code') %></label></h4>
						<div class="col-md-6 col-xs-6" style="padding:0px;">
                                    <input style="width:70%; margin:0px;" type="text" placeholder="3 dígitos" autocomplete="off" data-openpay-card="cvv2" class="form-control">
						</div>
						<div class="col-md-6 col-xs-6" >
						  <img src="/assets/cvv.png">
						</div>
					
                                
					</div>
				</div> <br>  <hr>
				<div class="row">
				    <div class="col-md-3 col-xs-6">
						<br>
					<h4 style="text-align:center"><label><%= t('openpay_transaction') %></label></h4>
						<h4 style="text-align:center"><img src="/assets/openpay.png"></h4>
					</div>
					<div class="col-md-4 col-xs-6" >
						<h4 style="text-align:center"><img src="/assets/security.png"></h4>
						<h4 style="text-align:center"><label><%= t('openpay_shield') %></label></h4>
						
					</div>
					<div class="col-md-5 col-xs-12">
						<br><br><br>
						 <h4 style="text-align:center"> <a class="btn btn-danger" id="pay-button"><%= t('buy') %></a>
                           
                          <a  class="btn btn-danger" id="register-button"><%= t('register') %></a></h4>
					</div>
				</div>
			</div>
		</form>
	</div>
	

</div>
<br>

<script>

$('.delete_card').click(function(e){
    e.preventDefault();
    var card_id = $(this).data("card");
                        
   var confirm1 = confirm("¿Estas seguro que deseas eliminar esta tarjeta de credito?");
        if(confirm1 == true){
                
                $.ajax({
                  method: "POST",
                  url: "/partials/credit_card_form/delete_card/"+card_id+"/<%= current_user.openpay_id %>",  
                })
                  .done(function( msg ) {
                    location.reload();
                  });
                     
                   
              }
                            });
</script>